C code for matrix multiply
==========================
\label{app:c}

Source code
-----------

```c
/**
 * Simple matrix multiply.
 *
 * @file main.c
 * @author Emily Ng
 * @date Feb 8 2016
 */

#include <stdio.h>
#include <stdlib.h>

#define SIZE 20

unsigned long long matrixMultiply(int *A, int *B, int *C, int n);
void loadMatrix(FILE *file, int *A, int size);
void printMatrix(int *A, int size);
void initializeMatrix(int *A, int size, int start);

unsigned long long matrixMultiply(int *A, int *B, int *C, int n) {
    int i, j, k;
    int row_dot_col;
    int sum = 0;

    for (i = 0; i < n; i++) {
        for (j = 0; j < n; j++) {
            row_dot_col = 0;
            for (k = 0; k < n; k++) {
                row_dot_col += A[i * n + k] * B[k * n + j];
            }
            sum += row_dot_col;
            C[i * n + j] = row_dot_col;
        }
    }

    return sum;
}

/** Initialize matrix.
 *
 * Initialize square matrix of size @size with sequential values starting with
 * @start.
 *
 * @param A     pointer to matrix
 * @param size  size of matrix
 * @start       offset
 */
void initializeMatrix(int *A, int size, int start) {
    int i;
    int n = size * size;

    for (i = 0; i < n; i++) {
        A[i] = start + i;
    }

    return;
}

int main(int argc, char *argv[]) {

    int A[SIZE * SIZE];
    int B[SIZE * SIZE];
    int C[SIZE * SIZE];
    int n = SIZE;

    initializeMatrix(A, SIZE, 1);
    initializeMatrix(B, SIZE, 1 + SIZE * SIZE);
    unsigned long long r = matrixMultiply(A, B, C, n);

    if (DEBUG) {
        puts("A");
        printMatrix(A, n);
        puts("B");
        printMatrix(B, n);
        puts("C = A x B");
        printMatrix(C, n);
    }

    puts("sum of elements in C");
    printf("%llu\n", r);
    
    return 0;
}
```

Recovered code
--------------

```c
//
// This file was generated by the Retargetable Decompiler
// Website: https://retdec.com
// Copyright (c) 2016 Retargetable Decompiler <info@retdec.com>
//

#include <stdbool.h>
#include <stdint.h>
#include <stdio.h>

// ------------------- Function Prototypes --------------------

void initializeMatrix(int32_t * A, int32_t size, int32_t start);
int64_t matrixMultiply(int32_t * A, int32_t * B, int32_t * C, uint32_t n);

// --------------------- Global Variables ---------------------

int32_t g1 = 0; // edx

// ------------------------ Functions -------------------------

// From module:   src/main.c
// Address range: 0x80484eb - 0x80485b4
// Line range:    27 - 44
int64_t matrixMultiply(int32_t * A, int32_t * B, int32_t * C, uint32_t n) {
    // 0x80484eb
    int32_t v1;
    int32_t j = v1; // bp-24
    int32_t v2;
    int32_t k = v2; // bp-20
    j = 0;
    int64_t result = 0;
    if (n > 0) {
        int32_t v3 = 0;
        int32_t v4 = 0;
        // branch -> 0x8048510
        int32_t v5; // 0x804856d
        while (true) {
            // 0x8048510
            k = 0;
            int32_t v6 = v3;
            int32_t v7 = 0; // 0x8048579
            int32_t v8 = v4;
            // branch -> 0x8048520
            int32_t v9;
            while (true) {
                int32_t v10 = v6 * n; // 0x8048523
                int32_t v11 = 0; // 0x804855e
                int32_t v12 = *(int32_t *)(4 * (v11 + v10) + (int32_t)A); // 0x804853a
                int32_t v13 = *(int32_t *)(4 * (v11 * n + v7) + (int32_t)B); // 0x8048556
                int32_t v14 = v13 * v12; // 0x804855b
                int32_t v15 = v11 + 1; // 0x804855e
                // branch -> 0x8048520
                while (v15 < n) {
                    // 0x8048520
                    v11 = v15;
                    v12 = *(int32_t *)(4 * (v11 + v10) + (int32_t)A);
                    v13 = *(int32_t *)(4 * (v11 * n + v7) + (int32_t)B);
                    v14 += v13 * v12;
                    v15 = v11 + 1;
                    // continue -> 0x8048520
                }
                // 0x804856a
                v5 = v14 + v8;
                *(int32_t *)(4 * (v10 + v7) + (int32_t)C) = v14;
                int32_t v16 = k + 1; // 0x804858f
                k = v16;
                v9 = j;
                if (v16 >= n) {
                    // break -> 0x804859f
                    break;
                }
                v6 = v9;
                v7 = v16;
                v8 = v5;
                // continue -> 0x8048520
            }
            int32_t v17 = v9 + 1; // 0x804859f
            j = v17;
            if (v17 >= n) {
                // break -> 0x80485a3
                break;
            }
            v3 = v17;
            v4 = v5;
            // continue -> 0x8048510
        }
        // 0x80485a3
        result = v5;
        // branch -> 0x80485af
    }
    // 0x80485af
    g1 = result < 0;
    return result;
}

// From module:   src/main.c
// Address range: 0x80486b0 - 0x80486f0
// Line range:    101 - 110
void initializeMatrix(int32_t * A, int32_t size, int32_t start) {
    // 0x80486b0
    int32_t v1;
    int32_t n = v1; // bp-12
    int32_t v2 = size * size; // 0x80486b9
    n = 0;
    if (v2 > 0) {
        // 0x80486c9
        *A = start;
        n = 1;
        if (v2 > 1) {
            int32_t v3 = 1; // 0x80486e28
            A[v3] = v3 + start;
            int32_t v4 = n + 1; // 0x80486e2
            n = v4;
            while (v4 < v2) {
                // 0x80486c9
                // 0x80486c9
                v3 = v4;
                A[v3] = v3 + start;
                v4 = n + 1;
                n = v4;
                // branch -> 0x80486c9
            }
            // 0x80486ee
            return;
        }
    }
}

// From module:   src/main.c
// Address range: 0x80486f1 - 0x80487cf
// Line range:    112 - 136
int main(int argc, char ** argv) {
    int32_t v1[400];
    int32_t v2[400];
    int32_t v3[400];
    // 0x80486f1
    int64_t v4;
    int64_t r = v4; // bp-4832
    initializeMatrix(v1, 20, 1);
    initializeMatrix(v2, 20, 401);
    r = matrixMultiply(v1, v2, v3, 20);
    puts("sum of elements in C");
    printf("%llu\n", r);
    // 0x80487bf
    return 0;
}

// --------------- Dynamically Linked Functions ---------------

// void __stack_chk_fail(void);
// int printf(const char *restrict, ...);
// int puts(const char *);

// --------------------- Meta-Information ---------------------

// Detected compiler/packer: gcc (5.2.1)
// Detected language: C
// Detected functions: 3
// Decompiler release: v2.1.2 (2016-01-27)
// Decompilation date: 2016-03-03 22:09:57
```
